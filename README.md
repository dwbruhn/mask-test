# mask-test

## Purpose

Demonstrate bug in [react-maskedinput](https://github.com/insin/react-maskedinput/) with Safari Credit Card Autofill feature.

**NOTE:** The credit card autofill only works on sites served over https with a valid certificate, so the self-signed certificate from the app has to be added to the system keychain.

## Usage

1. Install and start the app:

```bash
npm install
HTTPS=true npm start
```

2. Open https://localhost:3000 in Safari. When the certificate error pops up:
   1. Choose "Show Certificate"
   2. Expand "Trust"
   3. Change "When using this certificate" to "**Always Trust**". Authenticate as necessary and choose "Continue".
      1. This adds the self-signed certificate generated by the app to the keychain. (cf. https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#using-https-in-development)
3. Add a test credit card to Safari: Safari - Preferences - Autofill - Credit Cards (Edit) - Add
4. Click on the "Card Number" field in this app. Choose a credit card suggested by Safari. Observe that autocomplete fails.

## Demo

![demo](./demo.gif)

## Notes

Safari Credit Card AutoFill yields two events on the input form:

* `onKeyDown` (with key `Unidentified`)
* `onChange` (with `event.target.value` equal to the full credit card number)

Looking at the react-maskedinput code, the problem appears to be in the [`_onChange` method](https://github.com/insin/react-maskedinput/blob/f4cc837a48fce6673f45faa197a96a9c9041d67e/src/index.js#L131-L152), which doesn't call any [inputmask-core editing methods](https://github.com/insin/inputmask-core#inputmask-editing-methods) (except backspace).